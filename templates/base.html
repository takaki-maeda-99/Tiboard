<!DOCTYPE html>

<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django-blog</title>

    <style>
        /* メインメニューのスタイル */
        #side_bar {
            width: 200px;
            background-color: #2c3e50;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0; 
            padding: 0;
            overflow-y: auto;
        }
        
        #side_bar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
        }
        
        #side_bar li {
            border-top: 1px solid black;
        }
        
        #side_bar li a {
            font-family: 'Meiryo', 'Hiragino Kaku Gothic ProN', 'Helvetica', 'Arial', sans-serif;
            display: block;
            padding: 15px;
            text-decoration: none;
            color: #ecf0f1;
            background-color: #34495e;
            transition: .3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        #side_bar li a:hover {
            background-color: #1abc9c;
        }

        .sidebar-text {
            flex-grow: 1;
            padding: 15px;
            text-decoration: none;
            color: #ecf0f1;
            background-color: #34495e;
            transition: .3s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-text:hover {
            background-color: #1abc9c;
        }
        
        /* 矢印部分のホバースタイル */
        .arrow:hover {
            background-color: #1abc9c;
        }

        .body{
            margin-left: 200px;
            font-family: 'Meiryo', 'Hiragino Kaku Gothic ProN', 'Helvetica', 'Arial', sans-serif;
        }

        .scoreboard {
            border-bottom: 1px solid black;
        }

        /* 矢印のスタイル */
        .arrow {
            font-family: 'Meiryo', 'Hiragino Kaku Gothic ProN', 'Helvetica', 'Arial', sans-serif;
            transition: .3s;
            padding: 15px;
            align-content: center;
            color: white;
            background-color: #34495e;
        }

        .arrow.down::before {
            content: "▼";
        }

        .arrow.up::before {
            content: "▲";
        }

        .arrow-container {
            width: 30px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        /* ボタンの設定 */
        .menu_index {
            width: 200px;
            padding: 10px;
            display: flex;
            position: relative;
            z-index: 2;
            background-color: white;
            border: solid 1px;
            cursor: pointer;
        }
        
        .toggle_btn {
            position: relative;
            width: 1rem;
            height: 1rem;
        }
        
        .toggle_btn::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 1px;
            top: 0;
            bottom: 0;
            margin: auto;
            background-color: black;
            transition: .3s;
        }
        
        .toggle_btn::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 1px;
            top: 0;
            bottom: 0;
            margin: auto;
            background-color: black;
            transform: rotate(90deg);
            transition: .3s;
        }

        .toggle_btn.active::after {
            transform: rotate(0deg);
        }

        /* サブメニューの設定*/
        .menu_outer {
            width: fit-content;
            height: fit-content;
            overflow: hidden;
        }

        /* アコーディオンのアニメーション */
        .has-submenu .submenu {
            max-height: 0;
            transition: max-height .5s ease;
            overflow: hidden;
        }
        
        .has-submenu.open .submenu {
            max-height: 330px; /* 最大高さを設定。これを超えるとスクロール発生 */
            overflow-y: auto;  /* コンテンツが収まりきらない場合にスクロール */
            transition: max-height .5s ease; /* アニメーションで開閉 */
            background-color: lightcyan;
            overflow-y: auto;
        }

        .submenu {
            z-index: 1;
        }
        
        .submenu li {
            cursor: pointer;
            width: 100%;
        }
        
        .submenu li:hover {
            background-color: darkcyan;
            color: white;
        }
        
        .submenu li a {
            background-color: #4c637a;
        }
    </style>
</head>

<body>
    <div id="side_bar" class="sidebar">
        <ul class="include-accordion">
            <li class="dashboard">
                <a href="http://127.0.0.1:8000/">
                    <i class="dashboard"></i>
                    <span class="sidebar_text">Dashboard</span>
                </a>
            </li>

            <li class="taskboard has-submenu">
                <div style="display: flex; align-items: center;">
                    <a href="http://127.0.0.1:8000/task_board" class="sidebar-text">
                        <i class="taskboard"></i>
                        <span>Taskboard</span>
                    </a>
                    <div class="arrow-container">
                        <span class="arrow down"></span>
                    </div>
                </div>
                <ul class="submenu">
                    {% for course in tasks.courses %}
                        <li><a href="#">{{ course }}</a></li>
                    {% endfor %}
                </ul>
            </li>

            <li class="questionboard has-submenu">
                <div style="display: flex; align-items: center;">
                    <a href="http://127.0.0.1:8000/question_board" class="sidebar-text">
                        <i class="questionboard"></i>
                        <span class="sidebar_text">Questionboard</span>
                    </a>
                    <div class="arrow-container">
                        <span class="arrow down"></span>
                    </div>
                </div>
                <ul class="submenu">
                    {% for category in context.categories %}
                        <li><a href="{% url 'question_board:category_detail' category.id %}">{{ category.name }}</a></li>
                    {% endfor %}
                </ul>
            </li>
            
            <li class="scoreboard">
                <a href="http://127.0.0.1:8000/score_board">
                    <i class="scoreboard"></i>
                    <span class="sidebar_text">Scoreboard</span>
                </a>
            </li>
        </ul>       
    </div>

    <div class="body">
        <div class="main-content">{% block content %} {% endblock %}</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 全ての矢印のトグルを取得
            var arrowContainers = document.querySelectorAll('.arrow-container');
            
            // 各矢印にクリックイベントを追加
            arrowContainers.forEach(function(arrowContainer) {
                arrowContainer.addEventListener('click', function(event) {
                    event.preventDefault(); // リンクのデフォルト動作を無効化
                    
                    var parentLi = arrowContainer.closest('li'); // クリックされたメニューの親li要素を取得
                    var arrow = arrowContainer.querySelector('.arrow'); // 矢印を取得
                    
                    // アコーディオンメニューなので他のメニューは閉じる
                    document.querySelectorAll('.has-submenu.open').forEach(function(openItem) {
                        if (openItem !== parentLi) {
                            openItem.classList.remove('open');
                            var openArrow = openItem.querySelector('.arrow');
                            if (openArrow) openArrow.classList.remove('up');
                            if (openArrow) openArrow.classList.add('down');
                        }
                    });

                    // クリックされたメニューをトグル（開閉）する
                    parentLi.classList.toggle('open');
                    
                    // 矢印の向きをトグルする
                    if (arrow) {
                        arrow.classList.toggle('down');
                        arrow.classList.toggle('up');
                    }
                });
            });
        });
    </script>

</body>

</html>